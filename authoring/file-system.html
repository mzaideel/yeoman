<!doctype html><html lang=en><head><meta charset=utf-8><title>Working With The File System | Yeoman</title><meta name=viewport content="width=device-width"><link href="http://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Roboto:400,700,700italic,400italic" rel=stylesheet type=text/css><link rel=stylesheet href=/assets/css/main.6047.css><link href=/blog/atom.xml type=application/atom+xml rel=alternate title="Yeoman Blog Atom Feed"></head><body class=documentation><header class=page-header><div class=container><div class=mobile-bar><h1 class=logo><a href="/"><img src=/assets/img/logo.d20e.png alt=Yeoman></a></h1><button class="mobile-menu-toggle ir">open</button></div><nav class=main-menu><ul class=main-nav><li><a href=/learning>Using Yeoman</a><ul><li><a href=/learning/index.html>Getting started</a></li><li><a href=/codelab.html>Tutorial (codelab)</a></li><li><a href=/learning/resources.html>Resources</a></li><li><a href=/learning/deployment.html>Deployment</a></li><li><a href=/learning/faq.html>FAQ</a></li><li><a href=/learning/support.html>Support</a></li></ul></li><li><a href=/generators>Discovering generators</a></li><li><a href=/authoring class=active>Creating a generator</a><ul><li><a href=/authoring/index.html>Getting started</a></li><li><a href=/authoring/running-context.html>Running Context</a></li><li><a href=/authoring/user-interactions.html>User Interactions</a></li><li><a href=/authoring/composability.html>Composability</a></li><li><a href=/authoring/dependencies.html>Managing Dependencies</a></li><li><a href=/authoring/file-system.html class=active>Interacting with the file system</a></li><li><a href=/authoring/gruntfile.html>Creating a Gruntfile</a></li><li><a href=/authoring/storage.html>Storing user configs</a></li><li><a href=/authoring/testing.html>Unit testing</a></li><li><a href="http://yeoman.github.io/generator/">Full API documentation</a></li></ul></li><li><a href=/blog>Blog</a></li><li><a href=/contributing>Contributing</a><ul><li><a href=/contributing/index.html>Contributing</a></li><li><a href=/contributing/opening-issues.html>How to open an issue</a></li><li><a href=/contributing/pull-request.html>How to submit a PR</a></li><li><a href=/contributing/style-guide.html>Style Guide</a></li><li><a href=/contributing/testing-guidelines.html>Testing Guidelines</a></li><li><a href=/contributing/ticketing.html>Issue system overview</a></li></ul></li></ul></nav></div><!-- /.container --></header><!-- /.page-header --><div id=content><h2 class=page-title><div class=container>Working With The File System</div></h2><div class="container has-sidebar clearfix"><nav class=context-nav><ul><li><a href=/authoring/index.html>Getting started</a></li><li><a href=/authoring/running-context.html>Running Context</a></li><li><a href=/authoring/user-interactions.html>User Interactions</a></li><li><a href=/authoring/composability.html>Composability</a></li><li><a href=/authoring/dependencies.html>Managing Dependencies</a></li><li><a href=/authoring/file-system.html class=active>Interacting with the file system</a></li><li><a href=/authoring/gruntfile.html>Creating a Gruntfile</a></li><li><a href=/authoring/storage.html>Storing user configs</a></li><li><a href=/authoring/testing.html>Unit testing</a></li><li><a href="http://yeoman.github.io/generator/">Full API documentation</a></li></ul></nav><article class=main><section class=content-chunk><h2>Location contexts and paths</h2><p>Yeoman file utilities are based on the idea you always have two location contexts on disk. These contexts are folders your generator will most likely read from and write to.</p><h3>Destination context</h3><p>The first context is the <em>destination context</em>. The destination is the folder in which Yeoman will be scaffolding a new application. It is your user project folder, it is where you&#39;ll write most of the scaffolding.</p><p>The destination context is defined as either the current working directory or the closest parent folder containing a <code>.yo-rc.json</code> file. The <code>.yo-rc.json</code> file define the root of a Yeoman project. This file allows your user to run commands in subdirectories and have them work on the project. This ensure a consistent behaviour for the end user.</p><p>You can <strong>get</strong> the <em>destination path</em> using <code>generator.destinationRoot()</code> or by joining a path using <code>generator.destinationPath(&#39;sub/path&#39;)</code>.</p><div class=highlight><pre><code class="js language-js" data-lang=js><span class=c1>// Given destination root is ~/projects</span>
<span class=nx>generators</span><span class=p>.</span><span class=nx>Base</span><span class=p>.</span><span class=nx>extend</span><span class=p>({</span>
  <span class=nx>paths</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>destinationRoot</span><span class=p>();</span>
    <span class=c1>// returns &#39;~/projects&#39;</span>

    <span class=k>this</span><span class=p>.</span><span class=nx>destinationPath</span><span class=p>(</span><span class=s1>&#39;index.js&#39;</span><span class=p>);</span>
    <span class=c1>// returns &#39;~/projects/index.js&#39;</span>
  <span class=p>}</span>
<span class=p>});</span>
</code></pre></div><p>And you can manually set it using <code>generator.destinationRoot(&#39;new/path&#39;)</code>. But for consistency, you probably shouldn&#39;t change the default destination.</p><h3>Template context</h3><p>The template context is the folder in which you store your templates files. It is usually the folder from which you&#39;ll read and copy.</p><p>The template context is defined as <code>./templates/</code> by default. You can overwrite this default by using <code>generator.sourceRoot(&#39;new/template/path&#39;)</code>.</p><p>You can get the path value using <code>generator.sourceRoot()</code> or by joining a path using <code>generator.templatePath(&#39;app/index.js&#39;)</code>.</p><div class=highlight><pre><code class="js language-js" data-lang=js><span class=nx>generators</span><span class=p>.</span><span class=nx>Base</span><span class=p>.</span><span class=nx>extend</span><span class=p>({</span>
  <span class=nx>paths</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>sourceRoot</span><span class=p>();</span>
    <span class=c1>// returns &#39;./templates&#39;</span>

    <span class=k>this</span><span class=p>.</span><span class=nx>templatePath</span><span class=p>(</span><span class=s1>&#39;index.js&#39;</span><span class=p>);</span>
    <span class=c1>// returns &#39;~/templates/index.js&#39;</span>
  <span class=p>}</span>
<span class=p>});</span>
</code></pre></div><h2>An &quot;in memory&quot; file system</h2><p>Yeoman is very careful when in comes to overwriting users files. Basically, every write happening on a pre-existing file will go through a conflict resolution process. This process require the user validate every file write overwriting content to its file.</p><p>This behaviour prevent bad surprises and limit the risk of errors. On the other hand, this mean every file is written asynchronously to the disk.</p><p>As asynchronous API are harder to use, Yeoman provide a synchronous file-system API where every files get written to an <a href=https://github.com/sboudrias/mem-fs>in-memory file system</a> and are only written to disk once when Yeoman is done running.</p><p>This memory file system is shared between all <a href=/authoring/composability.html>composed generators</a>.</p><h2>File utilities</h2><p>Generators expose every file methods on <code>this.fs</code>. This object is an instance of <a href=https://github.com/sboudrias/mem-fs-editor>mem-fs editor</a> - make sure to check the <a href=https://github.com/sboudrias/mem-fs-editor>module documentation</a> for every methods available.</p><h3>Example: Copying a template file</h3><p>Here&#39;s an example where we&#39;d want to copy and process a template file.</p><p>Given the content of <code>./templates/index.html</code> is:</p><div class=highlight><pre><code class="html language-html" data-lang=html><span class=nt>&lt;html&gt;</span>
  <span class=nt>&lt;head&gt;</span>
    <span class=nt>&lt;title&gt;</span><span class=err>&lt;</span>%= title %&gt;<span class=nt>&lt;/title&gt;</span>
  <span class=nt>&lt;/head&gt;</span>
<span class=nt>&lt;/html&gt;</span>
</code></pre></div><p>We&#39;ll then use the <a href=https://github.com/sboudrias/mem-fs-editor#copytplfrom-to-context-settings><code>copyTpl</code></a> method to copy the file while processing the content as a template. <code>copyTpl</code> is using <a href=https://lodash.com/docs#template>Lodash template syntax</a>.</p><div class=highlight><pre><code class="js language-js" data-lang=js><span class=nx>generators</span><span class=p>.</span><span class=nx>Base</span><span class=p>.</span><span class=nx>extend</span><span class=p>({</span>
  <span class=nx>writing</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>fs</span><span class=p>.</span><span class=nx>copyTpl</span><span class=p>(</span>
      <span class=k>this</span><span class=p>.</span><span class=nx>templatePath</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>),</span>
      <span class=k>this</span><span class=p>.</span><span class=nx>destinationPath</span><span class=p>(</span><span class=s1>&#39;public/index.html&#39;</span><span class=p>),</span>
      <span class=p>{</span> <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;Templating with Yeoman&#39;</span> <span class=p>}</span>
    <span class=p>);</span>
  <span class=p>}</span>
<span class=p>});</span>
</code></pre></div><p>Once the generator is done running, <code>public/index.html</code> will contains:</p><div class=highlight><pre><code class="html language-html" data-lang=html><span class=nt>&lt;html&gt;</span>
  <span class=nt>&lt;head&gt;</span>
    <span class=nt>&lt;title&gt;</span>Templating with Yeoman<span class=nt>&lt;/title&gt;</span>
  <span class=nt>&lt;/head&gt;</span>
<span class=nt>&lt;/html&gt;</span>
</code></pre></div><h2>Legacy File utilities</h2><p>Yeoman also expose a set of older file utilities. You can refer to the <a href=http://yeoman.github.io/generator/actions.html>API documentation</a> to learn more about them.</p><p>The legacy file utilities have been back ported to use the in memory file system. As so, they&#39;re safe to use. Although be careful, these methods make a lot of assumptions and as a result will produce edge cases. When possible, prefer the more explicit new <code>fs</code> API.</p><p>The legacy file system make the assumption you want to write to the <em>destination context</em> and you want to read from the <em>template context</em>. As so, they don&#39;t require you to pass in a complete path, they&#39;ll resolve them automatically.</p><p>Also, legacy methods like <code>template</code> and <code>copy</code> will automatically process some templates passing the generator (e.g. <code>this</code>) as the data object.</p><h2>Tip: Update existing files content</h2><p>Updating a pre-existing file is not always a simple task. The most reliable way to do so is to parse the file AST (<a href=http://en.wikipedia.org/wiki/Abstract_syntax_tree>abstract syntax tree</a>) and edit it. The main issue with this solution is that editing an AST can be verbose and a bit hard to grasp.</p><p>Some popular AST parsers are:</p><ul><li><a href=https://github.com/cheeriojs/cheerio>Cheerio</a> for parsing HTML.</li><li><a href=https://github.com/ariya/esprima>Esprima</a> for parsing JavaScript - you might be interested in <a href=https://github.com/SBoudrias/ast-query>AST-Query</a> which provide a lower level API to edit Esprima syntax tree.</li><li>For JSON files, you can use the native <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON><code>JSON</code> object methods</a>.</li></ul><p>Yeoman also provides some common html file edition helpers. Refer to the <a href=http://yeoman.github.io/generator/wiring.html>API documentation</a> for the list of available methods.</p><p>Parsing code file with RegEx is perilous path, and before choosing to do so, you should read <a href=http://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags#answer-1732454>this CS anthopological answers</a> and grasp the flaws of RegEx parsing. If even then you do choose to edit existing files using RegEx rather than AST tree, please be careful and provide complete unit tests. - Please please, don&#39;t break your users code.</p><h2>Tip: Writing a Gruntfile</h2><p>Refer to the dedicated <a href=/authoring/gruntfile.html>Gruntfile documentation</a>.</p><div class=contribute-doc>Found a typo? An unclear example? Help us improve our documentation by forking and sending your fixes and suggestions. <a href=https://github.com/yeoman/yeoman.io/tree/master/app/authoring/file-system.md>Improve this Page!</a></div></section></article></div></div><footer class=page-footer><ul class="footer-links footer-links-social"><li><a href=https://plus.google.com/101063139999404044459/posts class=icon><img src=/assets/img/social-gplus.cdac.svg alt=Google+></a></li><li><a href=http://twitter.com/yeoman class=icon><img src=/assets/img/social-twitter.60eb.svg alt=Twitter></a></li><li><a href=http://github.com/yeoman/yeoman class=icon><img src=/assets/img/social-github.7679.svg alt=Github></a></li><li><a href=/blog/atom.xml class=icon><img src=/assets/img/social-feed.c635.svg alt=Feed></a></li></ul><ul class="footer-links footer-links-contribute"><li><a href="http://yeoman.github.io/generator/" class=btn>API</a></li><li><a href=https://github.com/yeoman/yeoman.io/blob/master/app/authoring/file-system.md class="btn btn-improve" title="Edit this page on Github to help improve the site">Improve this page</a></li></ul></footer><!-- /.footer-links --><script src=//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js></script><script src=/assets/js/scripts.1292.js></script><script>// $script.js - github.com/ded/script.js
  (function(a,b,c){typeof c["module"]!="undefined"&&c.module.exports?c.module.exports=b():typeof c["define"]!="undefined"&&c["define"]=="function"&&c.define.amd?define(a,b):c[a]=b()})("$script",function(){function p(a,b){for(var c=0,d=a.length;c<d;++c)if(!b(a[c]))return j;return 1}function q(a,b){p(a,function(a){return!b(a)})}function r(a,b,i){function o(a){return a.call?a():d[a]}function t(){if(!--n){d[m]=1,l&&l();for(var a in f)p(a.split("|"),o)&&!q(f[a],o)&&(f[a]=[])}}a=a[k]?a:[a];var j=b&&b.call,l=j?b:i,m=j?a.join(""):b,n=a.length;return setTimeout(function(){q(a,function(a){if(h[a])return m&&(e[m]=1),h[a]==2&&t();h[a]=1,m&&(e[m]=1),s(!c.test(a)&&g?g+a+".js":a,t)})},0),r}function s(c,d){var e=a.createElement("script"),f=j;e.onload=e.onerror=e[o]=function(){if(e[m]&&!/^c|loade/.test(e[m])||f)return;e.onload=e[o]=null,f=1,h[c]=2,d()},e.async=1,e.src=c,b.insertBefore(e,b.firstChild)}var a=document,b=a.getElementsByTagName("head")[0],c=/^https?:\/\//,d={},e={},f={},g,h={},i="string",j=!1,k="push",l="DOMContentLoaded",m="readyState",n="addEventListener",o="onreadystatechange";return!a[m]&&a[n]&&(a[n](l,function t(){a.removeEventListener(l,t,j),a[m]="complete"},j),a[m]="loading"),r.get=s,r.order=function(a,b,c){(function d(e){e=a.shift(),a.length?r(e,d):r(e,b,c)})()},r.path=function(a){g=a},r.ready=function(a,b,c){a=a[k]?a:[a];var e=[];return!q(a,function(a){d[a]||e[k](a)})&&p(a,function(a){return d[a]})?b():!function(a){f[a]=f[a]||[],f[a][k](b),c&&c(e)}(a.join("|")),r},r},this)
  var _gaq=[
    ['_setAccount','UA-32956520-1'],
    ['_setDomainName', '.yeoman.io'],
    ['_trackPageview'],['_trackPageLoadTime']
  ];
  $script('http://www.google-analytics.com/ga.js');
  $script('https://apis.google.com/js/plusone.js');
  $script("//platform.twitter.com/widgets.js");</script></body></html>